# uttl.buildout.cmake

Executes commands using a CMake build script, to e.g. to generate a Visual Studio solution or build an executable.

The recipe will automatically keep track of files that were generated, including when you run an `INSTALL` target. Only when the output was deleted will the command be run again.

## Configuration Options

`executable` (default: "cmake")

Path to the executable used to run commands. You don't need to set this if the executable was added to the system-wide `PATH` environment variable.

`always_install` (optional)

Set this option to 1 to skip checks for missing installed files and always run the script.

`artefact_path` (optional)

Manual tracking for the path to the artefact generated by CMake. While the script will automatically parse the output and track files that were generated when running the build step, this option can be useful to ensure that commands are run again when the output was deleted.

`generator` (mandatory when configuring)

Specifies the generator used by CMake when configuring the build environment, e.g. `Visual Studio 2017 15 Win64`.

`configure_path` (optional)

Runs the configure step for CMake and sets the output to the specified directory. When generating a Visual Studio solution, this is the folder where the files will be generated to.

`build_path` (optional)

Runs a build step on a previously configured `CMakeList.txt` at the specified directory, which will generate files used for other build systems (e.g. Visual Studio). The folder should already contain a `CMakeCache.txt`.

`install_path` (optional)

Used to set variables on the CMake cache and must point to the folder that contains the `CMakeLists.txt` configuration. Will also set the variable `CMAKE_INSTALL_PREFIX` to this path automatically.

`target` (optional)

Target(s) to build from the generated environment using the specified generator.

`config` (optional)

Configuration to build from the generated environment using the specified generator.

`var_<NAME> = <VALUE>:<TYPE>` (optional)

Every option that starts with `var_` is interpreted as a variable that needs to be passed to CMake when configuring or building. The value type is `STRING` by default and can be specified by appending `:` and the type to the value after the `=` in the buildout configuration. Valid types are `BOOL`, `FILEPATH`, `PATH`, `STRING`, and `INTERNAL`.

## Example - Downloading SDL2 source and compiling for Windows

	[buildout]
	parts = 
		sdl-download
		sdl-build

	# download the source code into the parts directory

	[sdl-download]
	recipe = hexagonit.recipe.download
	version = 2.0.16
	url = https://www.libsdl.org/release/SDL2-${:version}.zip
	strip-top-level-dir = true
	destination = ${buildout:parts-directory}/sdl-download

	# generate a visual studio 2017 solution for sdl2 in the download folder

	[sdl-solution]
	recipe = uttl.buildout:cmake
	configure_path = ${sdl-download:destination}/build
	install_path = ${sdl-download:destination}
	generator = Visual Studio 15 2017 Win64
	artefact_path = ${:configure_path}/SDL2.sln

	# build a release build for windows using cmake

	[sdl-build]
	recipe = uttl.buildout:cmake
	build_path = ${sdl-solution:configure_path}
	target = install
	config = Release

## Example - Cloning and compiling SDL_image, which depends on SDL2

	# clones using the slapos.recipe.build:gitclone recipe

	[sdl-image-master]
	recipe = slapos.recipe.build:gitclone
	git-executable = ${git:path}
	use-cache = true
	develop = true
	repository = https://github.com/libsdl-org/SDL_image.git

	# configures cmake and sets up required variables

	[sdl-image-solution]
	recipe = uttl.buildout:cmake
	configure_path = ${sdl-image-master:location}
	generator = ${cmake:generator}
	artefact_path = ${:configure_path}/SDL_image.sln
	install_path = ${sdl-image-master:location}
	var_SDL2_DIR = ${sdl-package:destination}/cmake:PATH

	# build a release build using cmake

	[sdl-image-build]
	recipe = uttl.buildout:cmake
	target = SDL2_image
	config = Release
	build_path = ${sdl-image-solution:configure_path}