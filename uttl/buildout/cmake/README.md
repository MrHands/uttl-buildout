# uttl.buildout.cmake

Executes commands using a CMake build script, to e.g. to generate a Visual Studio solution or build an executable.

The recipe will automatically keep track of files that were generated, including when you run an `INSTALL` target. Only when the output was deleted will the command be run again.

Depending on whether `configure-dir` or `build-dir` is set, the recipe will either configure or build the CMake configuration. Either the `source-dir` or `install-dir` option must always be set.

## Options

`executable` (default: "cmake")

Path to the executable used to run commands. You don't need to set this if the executable was added to the system-wide `PATH` environment variable.

`working-dir` (optional)

Change to this directory before executing the command.

`always-install` (optional)

Set this option to 1 to skip checks for missing installed files and always run the script.

`source-dir` (required, unlesss `install-dir` is set)

Directory that contains the `CMakeLists.txt` configuration. Will not invoke any CMake commands on its own.

`install-dir` (required, unless `source-dir` is set)

Used to set variables on the CMake cache and should point to directory that contains the `CMakeLists.txt` configuration. Will also set the variable `CMAKE_INSTALL_PREFIX` to this path automatically.

`configure-dir` (optional)

Runs a configure step for CMake and sets the output to the specified directory. When generating a Visual Studio solution, this is the folder where the files will be generated to.

`build-dir` (optional)

Runs a build step on a previously configured `CMakeList.txt` at the specified directory, which will generate files used for other build systems (e.g. Visual Studio). The directory should already contain a `CMakeCache.txt`.

`artefact-path` (optional)

Manual tracking for the path to the artefact generated by CMake. While the script will automatically parse the output and track files that were generated when running the build step, this option can be useful to ensure that commands are run again when the output was deleted.

`generator` (mandatory when configuring)

Specifies the generator used by CMake when configuring the build environment, e.g. `Visual Studio 2017 15 Win64`.

`targets` (optional)

List of targets to build from the generated environment. Only valid when `build-dir` is set.

`config` (optional)

Configuration to build from the generated environment. Only valid when `build-dir` is set.

`var-<NAME> = <VALUE>:<TYPE>` (optional)

Options that starts with `var-` are interpreted as a variable that needs to be passed to CMake when configuring or building. The value type is `STRING` by default and can be specified by appending `:` and the type to the value after the `=` in the buildout configuration. Valid types are `BOOL`, `FILEPATH`, `PATH`, `STRING`, and `INTERNAL`.

`artefacts` (optional)

Additional list of files that will be installed by the recipe but are not picked up automatically.

`arguments` (optional)

Additional list of arguments that are added to the executable _before_ the arguments generated by the recipe _without any processing_.

## Example - Downloading SDL2 source and compiling for Windows

	[buildout]
	parts = 
		sdl-download
		sdl-build

	# download the source code into the parts directory

	[sdl-download]
	recipe = hexagonit.recipe.download
	version = 2.0.16
	url = https://www.libsdl.org/release/SDL2-${:version}.zip
	strip-top-level-dir = true
	destination = ${buildout:parts-directory}/sdl-download

	# generate a visual studio 2017 solution for sdl2 in the download folder

	[sdl-solution]
	recipe = uttl.buildout:cmake
	source-dir = ${sdl-download:destination}
	configure-dir = ${:source-dir}/build
	install-dir = ${:source-dir}
	generator = Visual Studio 15 2017 Win64
	artefact-path = ${:configure-dir}/SDL2.sln

	# build a release build for windows using cmake

	[sdl-build]
	recipe = uttl.buildout:cmake
	build-dir = ${sdl-solution:configure-dir}
	target = install
	config = Release

## Example - Cloning and compiling SDL_image, which depends on SDL2

	# clone from github using the slapos.recipe.build:gitclone recipe

	[sdl-image-master]
	recipe = slapos.recipe.build:gitclone
	git-executable = ${git:path}
	use-cache = true
	develop = true
	repository = https://github.com/libsdl-org/SDL_image.git

	# configure cmake and sets up required variables

	[sdl-image-solution]
	recipe = uttl.buildout:cmake
	configure-dir = ${sdl-image-master:location}
	generator = ${cmake:generator}
	artefact-path = ${:configure-dir}/SDL_image.sln
	install-dir = ${sdl-image-master:location}
	var-SDL2_DIR = ${sdl-package:destination}/cmake:PATH

	# build a release build using cmake

	[sdl-image-build]
	recipe = uttl.buildout:cmake
	target = SDL2_image
	config = Release
	build-dir = ${sdl-image-solution:configure-dir}